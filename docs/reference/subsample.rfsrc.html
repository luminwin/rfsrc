<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Subsample Forests for VIMP Confidence Intervals — subsample.rfsrc • Fast Unified Random Forests with randomForestSRC</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Subsample Forests for VIMP Confidence Intervals — subsample.rfsrc"><meta property="og:description" content="Use subsampling to calculate confidence intervals and standard
  errors for VIMP (variable importance). Applies to all families."><meta property="og:image" content="https://www.randomforestsrc.org/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-WZWXVK817Z"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WZWXVK817Z');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Fast Unified Random Forests with randomForestSRC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/getstarted.html">
    <span class="fas fa-home fa-lg"></span>
     
    Getting Started
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li>
  <a href="../cheatsheets.pdf">Cheatsheet</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/parallel.html">Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/hybrid.html">Hybrid Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/algorithm.html">randomForestSRC Algorithm</a>
    </li>
    <li>
      <a href="../articles/speedup.html">Speedup Random Forest Analyses</a>
    </li>
    <li>
      <a href="../articles/forestWgt.html">Forest Weights, In-Bag (IB) and Out-of-Bag (OOB) Ensembles</a>
    </li>
    <li>
      <a href="../articles/survival.html">Random Survival Forests</a>
    </li>
    <li>
      <a href="../articles/competing.html">Competing Risks</a>
    </li>
    <li>
      <a href="../articles/imbalance.html">Random Forests Quantile Classifier (RFQ)</a>
    </li>
    <li>
      <a href="../articles/mvsplit.html">Multivariate Splitting Rule</a>
    </li>
    <li>
      <a href="../articles/aucsplit.html">AUC Splitting Rule for Multiclass Problems</a>
    </li>
    <li>
      <a href="../articles/sidClustering.html">sidClustering</a>
    </li>
    <li>
      <a href="../articles/rfsrc-subsample.html">Variable Importance (VIMP) with Subsampling Inference</a>
    </li>
    <li>
      <a href="../articles/minidep.html">Minimal Depth</a>
    </li>
    <li>
      <a href="../articles/partial.html">Partial Plots</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Manual</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSRC/issues" class="external-link">Bug Reporting</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSRC/discussions" class="external-link">Discussions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://kogalur.github.io/randomForestSRC/javadoc" class="external-link">Java API</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSRC/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kogalur/randomForestSRC/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Subsample Forests for VIMP Confidence Intervals</h1>
    
    <div class="hidden name"><code>subsample.rfsrc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Use subsampling to calculate confidence intervals and standard
  errors for VIMP (variable importance). Applies to all families.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">subsample</span><span class="op">(</span><span class="va">obj</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  block.size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">importance</span>,</span>
<span>  subratio <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stratify <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  performance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  performance.only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  joint <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  xvar.names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>obj</dt>
<dd><p>A forest grow object.</p></dd>


  <dt>B</dt>
<dd><p>Number of subsamples (or number of bootstraps).</p></dd>


  <dt>block.size</dt>
<dd><p>Specifies number of trees in a block when calculating
    VIMP.  This is over-ridden if VIMP is present in the original grow
    call in which case the grow value is used.</p></dd>


  <dt>importance</dt>
<dd><p>Optional: specifies the type of importance to be used,
    selected from one of "anti", "permute", "random".  If not specified
    reverts to default importance used by the package.  Also,
    this is over-ridden if the original grow object contains importance,
    in which case importance used in the original grow
    call is used.</p></dd>


  <dt>subratio</dt>
<dd><p>Ratio of subsample size to original sample size.  The
    default is approximately equal to the inverse square root of the
    sample size.</p></dd>


  <dt>stratify</dt>
<dd><p>Use stratified subsampling?  See details below.</p></dd>


  <dt>performance</dt>
<dd><p>Generalization error?  User can also request
    standard error and confidence regions for generalization error.</p></dd>


  <dt>performance.only</dt>
<dd><p>Only calculate standard error and confidence
    region for the generalization error (no VIMP).</p></dd>


  <dt>joint</dt>
<dd><p>Joint VIMP for all variables? Users can also request joint
    VIMP for specific variables using <code>xvar.names</code>.</p></dd>


  <dt>xvar.names</dt>
<dd><p>Specifies variables for calculating joint VIMP.  By
    default all variables are used.</p></dd>


  <dt>bootstrap</dt>
<dd><p>Use double bootstrap approach in place of
    subsampling?  Much slower, but potentially more accurate.</p></dd>


  <dt>verbose</dt>
<dd><p>Provide verbose output?</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    

<p>Using a previously trained forest, subsamples the data and constructs
  subsampled forests to estimate standard errors and confidence
  intervals for VIMP (Ishwaran and Lu, 2019).  If bootstrapping is
  requested, a double bootstrap is applied in place of subsampling.  The
  option <code>performance="TRUE"</code> constructs standard errors and
  confidence regions for the error rate (OOB performance) of the trained
  forest.  Options <code>joint</code> and <code>xvar.names</code> can be used to
  obtain joint VIMP for all or some variables.</p>
<p>If the trained forest does not have VIMP values, the algorithm first
  needs to calculate VIMP.  Therefore, if the user plans to make
  repeated calls to <code>subsample</code>, it is advisable to include VIMP in
  the original grow call.  Also, by calling VIMP in the original call,
  the type of importance used and other related parameters are set by
  values used in the original call which can eliminate confusion about
  what parameters are being used in the subsampled forests.  Thus, it is
  generally advised to call VIMP in the original call.</p>
<p>Subsampled forests are calculated using the same tuning parameters as
  the original forest.  While a sophisticated algorithm is utilized to
  acquire as many of these parameters as possible, keep in mind there
  are some conditions where this will fail: for example there are
  certain settings where the user has specified non-standard sampling in
  the grow forest.</p>  
<p>Delete-d jackknife estimators of the variance (Shao and Wu, 1989) are
  returned alongside subsampled variance estimators (Politis and Romano,
  1994).  While these methods are closely related, the jackknife
  estimator generally gives *larger* standard errors, which is a form of
  bias correction, and which occurs primarily for the signal variables.</p>
<p>By default, stratified subsampling is used for classification,
  survival, and competing risk families.  For classification,
  stratification is on the class label, while for survival and competing
  risk, stratification is on the event type and censoring.  Users are
  discouraged from over-riding this option, especially in small sample
  settings, as this could lead to error due to subsampled data not
  having full representation of class labels in classification settings,
  and in survival settings, subsampled data may be devoid of deaths
  and/or have reduced number of competing risks.  Note also that
  stratified sampling is not available for multivariate families --
  users should especially exercise caution when selecting subsampling
  rates here.</p>
<p>The function <code class="command">extract.subsample</code> can be used to extract
  information from the subsampled object.  Returned values for VIMP
  are "standardized" (this means for regression families, VIMP is
  standardized by dividing by the variance of Y and multiplying by 100;
  for all other families, VIMP is scaled by 100).  Use
  <code>standardize</code>="FALSE" if you want unstandardized VIMP.  Setting
  the option <code>raw</code>="TRUE" returns a more complete set of
  information that is used by the function <a href="plot.subsample.rfsrc.html">plot.subsample.rfsrc</a>
  for plotting confidence intervals.  Keep in mind some of this
  information will be subsampled VIMP that is "raw" in the sense it
  equals VIMP from a forest constructed with a much smaller sample
  size.  This option is for experts only.</p>  
<p>When printing or plotting results, the default is to standardize
  VIMP which can be turned off using the option <code>standardize</code>.
  Also these wrappers preset the "alpha" value used for confidence
  intervals; users can change this using option <code>alpha</code>.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list with the following key components:</p>
<dl><dt>rf</dt>
<dd><p>Original forest grow object.</p></dd>

  <dt>vmp</dt>
<dd><p>Variable importance values for grow forest.</p></dd>

  <dt>vmpS</dt>
<dd><p>Variable importance subsampled values.</p></dd>

  <dt>subratio</dt>
<dd><p>Subratio used.</p></dd>
  
</dl></div>
    <div id="author">
    <h2>Author</h2>
    <p>Hemant Ishwaran and Udaya B. Kogalur</p>
    </div>
    <div id="references">
    <h2>References</h2>
    

<p>Ishwaran H. and Lu M.  (2019).  Standard errors and confidence
  intervals for variable importance in random forest regression,
  classification, and survival. <em>Statistics in Medicine</em>, 38,
  558-582.</p>
<p>Politis, D.N. and Romano, J.P. (1994). Large sample confidence
  regions based on subsamples under minimal assumptions. <em>The
  Annals of Statistics</em>, 22(4):2031-2050.</p>
<p>Shao, J. and Wu, C.J. (1989). A general theory for jackknife variance
  estimation. <em>The Annals of Statistics</em>, 17(3):1176-1197.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code class="command"><a href="holdout.vimp.rfsrc.html">holdout.vimp.rfsrc</a></code>
  <code class="command"><a href="plot.subsample.rfsrc.html">plot.subsample.rfsrc</a></code>,
  <code class="command"><a href="rfsrc.html">rfsrc</a></code>,
  <code class="command"><a href="vimp.rfsrc.html">vimp.rfsrc</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># \donttest{</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## regression</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## training the forest</span></span>
<span><span class="va">reg.o</span> <span class="op">&lt;-</span> <span class="fu"><a href="rfsrc.html">rfsrc</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">airquality</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## default subsample call</span></span>
<span><span class="va">reg.smp.o</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">reg.o</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plot confidence regions</span></span>
<span><span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">reg.smp.o</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## summary of results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reg.smp.o</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## joint vimp and confidence region for generalization error</span></span>
<span><span class="va">reg.smp.o2</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">reg.o</span>, performance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           joint <span class="op">=</span> <span class="cn">TRUE</span>, xvar.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Day"</span>, <span class="st">"Month"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">reg.smp.o2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## now try the double bootstrap (slower)</span></span>
<span><span class="va">reg.dbs.o</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">reg.o</span>, B <span class="op">=</span> <span class="fl">25</span>, bootstrap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reg.dbs.o</span><span class="op">)</span></span>
<span><span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">reg.dbs.o</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## standard error and confidence region for generalization error only</span></span>
<span><span class="va">gerror</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">reg.o</span>, performance.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">gerror</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## classification</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## 3 non-linear, 15 linear, and 5 noise variables </span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/topepo/caret/" class="external-link">"caret"</a></span>, logical.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/twoClassSim.html" class="external-link">twoClassSim</a></span><span class="op">(</span><span class="fl">1000</span>, linearVars <span class="op">=</span> <span class="fl">15</span>, noiseVars <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## VIMP based on (default) misclassification error</span></span>
<span>  <span class="va">cls.o</span> <span class="op">&lt;-</span> <span class="fu"><a href="rfsrc.html">rfsrc</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">d</span><span class="op">)</span></span>
<span>  <span class="va">cls.smp.o</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">cls.o</span>, B <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">cls.smp.o</span>, cex.axis <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## same as above, but with VIMP defined using normalized Brier score</span></span>
<span>  <span class="va">cls.o2</span> <span class="op">&lt;-</span> <span class="fu"><a href="rfsrc.html">rfsrc</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">d</span>, perf.type <span class="op">=</span> <span class="st">"brier"</span><span class="op">)</span></span>
<span>  <span class="va">cls.smp.o2</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">cls.o2</span>, B <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">cls.smp.o2</span>, cex.axis <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## class-imbalanced data using RFQ classifier with G-mean VIMP</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/topepo/caret/" class="external-link">"caret"</a></span>, logical.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co">## experimental settings</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span>  <span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span>  <span class="va">ir</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co">## simulate the data, create minority class data</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/twoClassSim.html" class="external-link">twoClassSim</a></span><span class="op">(</span><span class="va">n</span>, linearVars <span class="op">=</span> <span class="fl">15</span>, noiseVars <span class="op">=</span> <span class="va">q</span><span class="op">)</span></span>
<span>  <span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">idx.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">idx.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="va">ir</span> , replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">idx.0</span>,<span class="va">idx.1</span><span class="op">)</span>,, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co">## RFQ classifier</span></span>
<span>  <span class="va">oq</span> <span class="op">&lt;-</span> <span class="fu"><a href="imbalanced.rfsrc.html">imbalanced</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">d</span>, importance <span class="op">=</span> <span class="cn">TRUE</span>, block.size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## subsample the RFQ-classifier</span></span>
<span>  <span class="va">smp.oq</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">oq</span>, B <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">smp.oq</span>, cex.axis <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## survival </span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pbc</span>, package <span class="op">=</span> <span class="st">"randomForestSRC"</span><span class="op">)</span></span>
<span><span class="va">srv.o</span> <span class="op">&lt;-</span> <span class="fu"><a href="rfsrc.html">rfsrc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">pbc</span><span class="op">)</span></span>
<span><span class="va">srv.smp.o</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">srv.o</span>, B <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">srv.smp.o</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## competing risks</span></span>
<span><span class="co">## target event is death (event = 2)</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/therneau/survival" class="external-link">"survival"</a></span>, logical.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pbc</span>, package <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span></span>
<span>  <span class="va">pbc</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">cr.o</span> <span class="op">&lt;-</span> <span class="fu"><a href="rfsrc.html">rfsrc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">pbc</span>, splitrule <span class="op">=</span> <span class="st">"logrankCR"</span>, cause <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">cr.smp.o</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">cr.o</span>, B <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">cr.smp.o</span>, target <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## multivariate </span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"mlbench"</span>, logical.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## simulate the data </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BostonHousing</span><span class="op">)</span></span>
<span>  <span class="va">bh</span> <span class="op">&lt;-</span> <span class="va">BostonHousing</span></span>
<span>  <span class="va">bh</span><span class="op">$</span><span class="va">rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">bh</span><span class="op">$</span><span class="va">rm</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="rfsrc.html">rfsrc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">medv</span>, <span class="va">rm</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">bh</span><span class="op">)</span></span>
<span>  <span class="va">so</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">o</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">so</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">so</span>, m.target <span class="op">=</span> <span class="st">"rm"</span><span class="op">)</span></span>
<span>  <span class="co">##generalization error</span></span>
<span>  <span class="va">gerror</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">o</span>, performance.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">gerror</span>, m.target <span class="op">=</span> <span class="st">"medv"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">gerror</span>, m.target <span class="op">=</span> <span class="st">"rm"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## largish data example - use rfsrc.fast for fast forests</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/topepo/caret/" class="external-link">"caret"</a></span>, logical.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## largish data set</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/twoClassSim.html" class="external-link">twoClassSim</a></span><span class="op">(</span><span class="fl">1000</span>, linearVars <span class="op">=</span> <span class="fl">15</span>, noiseVars <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## use a subsampled forest with Brier score performance</span></span>
<span>  <span class="co">## remember to set forest=TRUE for rfsrc.fast</span></span>
<span>  <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="rfsrc.fast.html">rfsrc.fast</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">d</span>, ntree <span class="op">=</span> <span class="fl">100</span>,</span>
<span>           forest <span class="op">=</span> <span class="cn">TRUE</span>, perf.type <span class="op">=</span> <span class="st">"brier"</span><span class="op">)</span></span>
<span>  <span class="va">so</span> <span class="op">&lt;-</span> <span class="fu">subsample</span><span class="op">(</span><span class="va">o</span>, B <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="plot.subsample.rfsrc.html">plot.subsample</a></span><span class="op">(</span><span class="va">so</span>, cex.axis <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># }</span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.luminwin.net" class="external-link">Min Lu</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

