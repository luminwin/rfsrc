<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Subsample Forests for VIMP Confidence Intervals — subsample.rfsrc • Fast Unified Random Forests with randomForestSRC</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Subsample Forests for VIMP Confidence Intervals — subsample.rfsrc" />
<meta property="og:description" content="Use subsampling to calculate confidence intervals and standard
  errors for VIMP (variable importance). Applies to all families." />
<meta property="og:image" content="http://www.randomforestsrc.org/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WZWXVK817Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WZWXVK817Z');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Fast Unified Random Forests with randomForestSRC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">3.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/getstarted.html">
    <span class="fas fa-home fa-lg"></span>
     
    Getting Started
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li>
  <a href="../cheatsheets.pdf">Cheatsheet</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/parallel.html">Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/hybrid.html">Hybrid Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/algorithm.html">randomForestSRC Algorithm</a>
    </li>
    <li>
      <a href="../articles/speedup.html">Speedup Random Forest Analyses</a>
    </li>
    <li>
      <a href="../articles/forestWgt.html">Forest Weights, In-Bag (IB) and Out-of-Bag (OOB) Ensembles</a>
    </li>
    <li>
      <a href="../articles/survival.html">Random Survival Forests</a>
    </li>
    <li>
      <a href="../articles/competing.html">Competing Risks</a>
    </li>
    <li>
      <a href="../articles/imbalance.html">Random Forests Quantile Classifier (RFQ)</a>
    </li>
    <li>
      <a href="../articles/mvsplit.html">Multivariate Splitting Rule</a>
    </li>
    <li>
      <a href="../articles/sidClustering.html">sidClustering</a>
    </li>
    <li>
      <a href="../articles/rfsrc-subsample.html">Variable Importance (VIMP) with Subsampling Inference</a>
    </li>
    <li>
      <a href="../articles/minidep.html">Minimal Depth</a>
    </li>
    <li>
      <a href="../articles/partial.html">Partial Plots</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Manual</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSRC/issues">Bug Reporting</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSRC/discussions">Discussions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://kogalur.github.io/randomForestSRC/javadoc">Java API</a>
</li>
<li>
  <a href="https://github.com/kogalur/randomForestSRC/">
    <span class="fab fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Subsample Forests for VIMP Confidence Intervals</h1>
    
    <div class="hidden name"><code>subsample.rfsrc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Use subsampling to calculate confidence intervals and standard
  errors for VIMP (variable importance). Applies to all families.</p>
    </div>

    <pre class="usage"><span class='fu'>subsample</span><span class='op'>(</span><span class='va'>obj</span>,
  B <span class='op'>=</span> <span class='fl'>100</span>,
  block.size <span class='op'>=</span> <span class='fl'>1</span>,
  subratio <span class='op'>=</span> <span class='cn'>NULL</span>,
  stratify <span class='op'>=</span> <span class='cn'>TRUE</span>,
  performance <span class='op'>=</span> <span class='cn'>FALSE</span>,
  joint <span class='op'>=</span> <span class='cn'>FALSE</span>,
  bootstrap <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>obj</th>
      <td><p>A forest grow object.</p></td>
    </tr>
    <tr>
      <th>B</th>
      <td><p>Number of subsamples (or number of bootstraps).</p></td>
    </tr>
    <tr>
      <th>block.size</th>
      <td><p>Specifies number of trees in a block when calculating
    VIMP.  This is over-ridden if VIMP is present in the original grow
    call in which case the grow value is used.</p></td>
    </tr>
    <tr>
      <th>subratio</th>
      <td><p>Ratio of subsample size to original sample size.  The
    default is the inverse square root of the sample size.</p></td>
    </tr>
    <tr>
      <th>stratify</th>
      <td><p>Use stratified subsampling?  See details below.</p></td>
    </tr>
    <tr>
      <th>performance</th>
      <td><p>Error rate of forest?  Used to obtain
    standard error and confidence region for the ensemble out-of-sample performance.</p></td>
    </tr>
    <tr>
      <th>joint</th>
      <td><p>Include the VIMP for all variables jointly perturbed?
    This is useful reference problems where one might be suspicious that
    many (or all) variables are noise.</p></td>
    </tr>
    <tr>
      <th>bootstrap</th>
      <td><p>Use double bootstrap approach in place of
    subsampling?  Much slower, but potentially more accurate.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Provide verbose output?</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>Given a forest object, subsamples the data and constructs subsampled
  forests to estimate standard errors and confidence intervals for VIMP
  (Ishwaran and Lu, 2019).  If bootstrapping is requested, a double
  bootstrap is applied in place of subsampling.  The option
  <code>performance</code> can also be used to obtain standard errors and
  confidence regions for the ensemble out-of-sample performance.</p>
<p>If VIMP is not present in the original forest object, the algorithm
  will first need to calculate VIMP.  Therefore, if the user plans to
  make repeated calls to <code>subsample</code>, it is advisable to include
  VIMP in the original grow call.  Subsampled forests are calculated
  using the same tuning parameters as the original forest.  While a
  sophisticated algorithm is utilized to acquire as many of these
  parameters as possible, keep in mind there are some conditions where
  this will fail: for example there are certain settings where the user
  has specified non-standard sampling in the grow forest.</p>  
<p>Delete-d jackknife estimators of the variance (Shao and Wu, 1989) are
  returned alongside subsampled variance estimators (Politis and Romano,
  1994).  While these two methods are closely related, estimated
  standard error for VIMP from delete-d estimators are generally larger
  than from subsampled estimators, which is a form of bias correction,
  which occurs primarily for variables with true signal.  Confidence
  interval coverage is generally better under delete-d estimators, but
  undercoverage for strong variables and overcoverage for noise
  variables is exhibited by both estimators.  This however may be
  beneficial if the goal is variable selection (Ishwaran and Lu, 2019).</p>
<p>By default, stratified subsampling is used for classification,
  survival, and competing risk families.  For classification,
  stratification is on the class label, while for survival and competing
  risk, stratification is on the event type and censoring.  Users are
  discouraged from over-riding this option, especially in small sample
  settings, as this could lead to error due to subsampled data not
  having full representation of class labels in classification settings,
  and in survival settings, subsampled data may be devoid of deaths
  and/or have reduced number of competing risks.  Note also that
  stratified sampling is not available for multivariate families --
  users should especially exercise caution when selecting subsampling
  rates here.</p>
<p>The function <code class='command'>extract.subsample</code> conveniently extracts
  information from the subsampled object.  It returns summary
  information (used for plotting confidence intervals) as well as VIMP
  from the original forest and VIMP from the subsampled forests.  Keep in
  mind this subsampled VIMP is "raw" in the sense it equals VIMP
  from a forest constructed with a much smaller sample size. No
  processing of the subsampled VIMP to the original sample size is done.
  Also, all returned VIMP is "standardized" (this means for regression
  families, VIMP is standardized by dividing by the variance of Y and
  multiplying by 100.  For all other families, VIMP is scaled by 100).
  Use <code>standardize=FALSE</code> if you want unstandardized VIMP.</p>  
<p>When printing or plotting results, the default is to standardize
  VIMP. This can be turned off using the option <code>standardize</code> in
  those wrappers.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with the following key components:</p>
<dt>rf</dt><dd><p>Original forest grow object.</p></dd>
  <dt>vmp</dt><dd><p>Variable importance values for grow forest.</p></dd>
  <dt>vmpS</dt><dd><p>Variable importance subsampled values.</p></dd>
  <dt>subratio</dt><dd><p>Subratio used.</p></dd>  

    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Hemant Ishwaran and Udaya B. Kogalur</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    

<p>Ishwaran H. and Lu M.  (2019).  Standard errors and confidence
  intervals for variable importance in random forest regression,
  classification, and survival. <em>Statistics in Medicine</em>, 38,
  558-582.</p>
<p>Politis, D.N. and Romano, J.P. (1994). Large sample confidence
  regions based on subsamples under minimal assumptions. <em>The
  Annals of Statistics</em>, 22(4):2031-2050.</p>
<p>Shao, J. and Wu, C.J. (1989). A general theory for jackknife variance
  estimation. <em>The Annals of Statistics</em>, 17(3):1176-1197.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code class='command'><a href='holdout.vimp.rfsrc.html'>holdout.vimp.rfsrc</a></code>
  <code class='command'><a href='plot.subsample.rfsrc.html'>plot.subsample.rfsrc</a></code>,
  <code class='command'><a href='rfsrc.html'>rfsrc</a></code>,
  <code class='command'><a href='vimp.rfsrc.html'>vimp.rfsrc</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># \donttest{</span>
<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## regression example</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='co'>## grow the forest - request VIMP</span>
<span class='va'>reg.o</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rfsrc.html'>rfsrc</a></span><span class='op'>(</span><span class='va'>mpg</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>mtcars</span><span class='op'>)</span>

<span class='co'>## very small sample size so need largish subratio</span>
<span class='va'>reg.smp.o</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>reg.o</span>, B <span class='op'>=</span> <span class='fl'>25</span>, subratio <span class='op'>=</span> <span class='fl'>.5</span><span class='op'>)</span>

<span class='co'>## plot confidence regions</span>
<span class='fu'><a href='plot.subsample.rfsrc.html'>plot.subsample</a></span><span class='op'>(</span><span class='va'>reg.smp.o</span><span class='op'>)</span>

<span class='co'>## summary of results</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>reg.smp.o</span><span class='op'>)</span>

<span class='co'>## extract subsampled VIMP</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>extract.subsample</span><span class='op'>(</span><span class='va'>reg.smp.o</span><span class='op'>)</span><span class='op'>$</span><span class='va'>vmpS</span><span class='op'>)</span>

<span class='co'>## extract unstandardized subsampled VIMP</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>extract.subsample</span><span class='op'>(</span><span class='va'>reg.smp.o</span>, standardize<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>$</span><span class='va'>vmpS</span><span class='op'>)</span>

<span class='co'>## now try the double bootstrap (slow!!)</span>
<span class='va'>reg.dbs.o</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>reg.o</span>, B <span class='op'>=</span> <span class='fl'>25</span>, bootstrap <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>reg.dbs.o</span><span class='op'>)</span>
<span class='fu'><a href='plot.subsample.rfsrc.html'>plot.subsample</a></span><span class='op'>(</span><span class='va'>reg.dbs.o</span><span class='op'>)</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## classification example</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='co'>## 3 non-linear, 15 linear, and 5 noise variables </span>
<span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://github.com/topepo/caret/'>"caret"</a></span>, logical.return <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/twoClassSim.html'>twoClassSim</a></span><span class='op'>(</span><span class='fl'>1000</span>, linearVars <span class='op'>=</span> <span class='fl'>15</span>, noiseVars <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>

  <span class='co'>## VIMP based on (default) misclassification error</span>
  <span class='va'>cls.o</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rfsrc.html'>rfsrc</a></span><span class='op'>(</span><span class='va'>Class</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>d</span><span class='op'>)</span>
  <span class='va'>cls.smp.o</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>cls.o</span>, B <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
  <span class='fu'><a href='plot.subsample.rfsrc.html'>plot.subsample</a></span><span class='op'>(</span><span class='va'>cls.smp.o</span>, cex.axis <span class='op'>=</span> <span class='fl'>.7</span><span class='op'>)</span>

  <span class='co'>## same as above, but with VIMP defined using normalized Brier score</span>
  <span class='va'>cls.o2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rfsrc.html'>rfsrc</a></span><span class='op'>(</span><span class='va'>Class</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>d</span>, perf.type <span class='op'>=</span> <span class='st'>"brier"</span><span class='op'>)</span>
  <span class='va'>cls.smp.o2</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>cls.o2</span>, B <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
  <span class='fu'><a href='plot.subsample.rfsrc.html'>plot.subsample</a></span><span class='op'>(</span><span class='va'>cls.smp.o2</span>, cex.axis <span class='op'>=</span> <span class='fl'>.7</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## class-imbalanced example</span>
<span class='co'>## uses q-classifier with G-mean VIMP</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://github.com/topepo/caret/'>"caret"</a></span>, logical.return <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>

  <span class='co'>## experimental settings</span>
  <span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
  <span class='va'>q</span> <span class='op'>&lt;-</span> <span class='fl'>20</span>
  <span class='va'>ir</span> <span class='op'>&lt;-</span> <span class='fl'>6</span>
  <span class='va'>f</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/formula.html'>as.formula</a></span><span class='op'>(</span><span class='va'>Class</span> <span class='op'>~</span> <span class='va'>.</span><span class='op'>)</span>
 
  <span class='co'>## simulate the data, create minority class data</span>
  <span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/twoClassSim.html'>twoClassSim</a></span><span class='op'>(</span><span class='va'>n</span>, linearVars <span class='op'>=</span> <span class='fl'>15</span>, noiseVars <span class='op'>=</span> <span class='va'>q</span><span class='op'>)</span>
  <span class='va'>d</span><span class='op'>$</span><span class='va'>Class</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>$</span><span class='va'>Class</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='va'>idx.0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>$</span><span class='va'>Class</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span>
  <span class='va'>idx.1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>$</span><span class='va'>Class</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>$</span><span class='va'>Class</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>ir</span> , replace <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
  <span class='va'>d</span> <span class='op'>&lt;-</span> <span class='va'>d</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>idx.0</span>,<span class='va'>idx.1</span><span class='op'>)</span>,, drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span>

  <span class='co'>## q-classifier</span>
  <span class='va'>oq</span> <span class='op'>&lt;-</span> <span class='fu'><a href='imbalanced.rfsrc.html'>imbalanced</a></span><span class='op'>(</span><span class='va'>Class</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>d</span>, splitrule <span class='op'>=</span> <span class='st'>"auc"</span>,
              importance <span class='op'>=</span> <span class='cn'>TRUE</span>, block.size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

  <span class='co'>## subsample the q-classifier</span>
  <span class='va'>smp.oq</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>oq</span>, B <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>smp.oq</span>, cex.axis <span class='op'>=</span> <span class='fl'>.7</span><span class='op'>)</span>

<span class='op'>}</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## survival example</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>pbc</span>, package <span class='op'>=</span> <span class='st'>"randomForestSRC"</span><span class='op'>)</span>
<span class='va'>srv.o</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rfsrc.html'>rfsrc</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>days</span>, <span class='va'>status</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>pbc</span><span class='op'>)</span>
<span class='va'>srv.smp.o</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>srv.o</span>, B <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>srv.smp.o</span><span class='op'>)</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## competing risk example</span>
<span class='co'>## target event is death (event = 2)</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://github.com/therneau/survival'>"survival"</a></span>, logical.return <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>pbc</span>, package <span class='op'>=</span> <span class='st'>"survival"</span><span class='op'>)</span>
  <span class='va'>pbc</span><span class='op'>$</span><span class='va'>id</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
  <span class='va'>cr.o</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rfsrc.html'>rfsrc</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>time</span>, <span class='va'>status</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>pbc</span>, splitrule <span class='op'>=</span> <span class='st'>"logrankCR"</span>, cause <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
  <span class='va'>cr.smp.o</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>cr.o</span>, B <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
  <span class='fu'><a href='plot.subsample.rfsrc.html'>plot.subsample</a></span><span class='op'>(</span><span class='va'>cr.smp.o</span>, target <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## multivariate family</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'>"mlbench"</span>, logical.return <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>## simulate the data </span>
  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>BostonHousing</span><span class='op'>)</span>
  <span class='va'>bh</span> <span class='op'>&lt;-</span> <span class='va'>BostonHousing</span>
  <span class='va'>bh</span><span class='op'>$</span><span class='va'>rm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>bh</span><span class='op'>$</span><span class='va'>rm</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rfsrc.html'>rfsrc</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>medv</span>, <span class='va'>rm</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>bh</span><span class='op'>)</span>
  <span class='va'>so</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>o</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>so</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>so</span>, m.target <span class='op'>=</span> <span class='st'>"rm"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## ------------------------------------------------------------</span>
<span class='co'>## largish data example - use rfsrc.fast for fast forests</span>
<span class='co'>## ------------------------------------------------------------</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://github.com/topepo/caret/'>"caret"</a></span>, logical.return <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>## largish data set</span>
  <span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/twoClassSim.html'>twoClassSim</a></span><span class='op'>(</span><span class='fl'>1000</span>, linearVars <span class='op'>=</span> <span class='fl'>15</span>, noiseVars <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>

  <span class='co'>## use a subsampled forest with Brier score performance</span>
  <span class='co'>## remember to request forests in rfsrc.fast</span>
  <span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rfsrc.fast.html'>rfsrc.fast</a></span><span class='op'>(</span><span class='va'>Class</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>d</span>, ntree <span class='op'>=</span> <span class='fl'>100</span>,
           forest <span class='op'>=</span> <span class='cn'>TRUE</span>, perf.type <span class='op'>=</span> <span class='st'>"brier"</span><span class='op'>)</span>
  <span class='va'>so</span> <span class='op'>&lt;-</span> <span class='fu'>subsample</span><span class='op'>(</span><span class='va'>o</span>, B <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
  <span class='fu'><a href='plot.subsample.rfsrc.html'>plot.subsample</a></span><span class='op'>(</span><span class='va'>so</span>, cex.axis <span class='op'>=</span> <span class='fl'>.7</span><span class='op'>)</span>
<span class='op'>}</span>


<span class='co'># }</span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://ishwaran.org/ishwaran.html'>Hemant Ishwaran</a>, Udaya B. Kogalur.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


